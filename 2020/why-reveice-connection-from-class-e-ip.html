<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="author" content="zu1k"><meta name="subtitle" content="an interest-driven blog"><meta name="description" content="Hi, I'm zu1k, a boy dreaming of traveling around the world. "><meta name="keywords" content="zu1k,lgf,zuik,lgf.im"><title>一个来自保留IP地址的连接 | zu1k</title><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/style.css"><script src="/js/script.js"></script><script src="/js/tocbot.min.js"></script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="zu1k" type="application/atom+xml"><link rel="alternate" href="/rss2.xml" title="zu1k" type="application/rss+xml"></head><body><div class="wrapper"><header><nav class="navbar"><div class="container"><div class="navbar-header header-logo"><a href="/">ZU1K</a></div><div class="menu navbar-right"><a class="menu-item" href="/archives">Posts</a> <a class="menu-item" href="/category">Category</a> <a class="menu-item" href="/tag">Tag</a> <a class="menu-item" href="/about">About</a> <a class="menu-item" href="/feed">Feed</a> <input id="switch_default" type="checkbox" class="switch_default"> <label for="switch_default" class="toggleBtn"></label></div></div></nav><nav class="navbar-mobile" id="nav-mobile"><div class="container"><div class="navbar-header"><div><a href="/">ZU1K</a><a id="mobile-toggle-theme">·&nbsp;Light</a></div><div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div></div><div class="menu" id="mobile-menu"><a class="menu-item" href="/archives">Posts</a> <a class="menu-item" href="/category">Category</a> <a class="menu-item" href="/tag">Tag</a> <a class="menu-item" href="/about">About</a> <a class="menu-item" href="/feed">Feed</a></div></div></nav></header><script>var mobileBtn=function(){var e=document.getElementsByClassName("menu-toggle")[0],t=document.getElementById("mobile-menu");e.classList.contains("active")?(e.classList.remove("active"),t.classList.remove("active")):(e.classList.add("active"),t.classList.add("active"))}</script><div class="main"><div class="container"><div class="post-toc"><div class="tocbot-list"></div><div class="tocbot-list-menu"><a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a> <a onclick="go_top()">Back to top</a> <a onclick="go_bottom()">Go to bottom</a></div></div><script>function expand_toc(){var o=document.querySelector(".tocbot-toc-expand");tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:6,orderedList:!1,scrollSmooth:!0}),o.setAttribute("onclick","collapse_toc()"),o.innerHTML="Collapse all"}function collapse_toc(){var o=document.querySelector(".tocbot-toc-expand");tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:1,orderedList:!1,scrollSmooth:!0}),o.setAttribute("onclick","expand_toc()"),o.innerHTML="Expand all"}function go_top(){window.scrollTo(0,0)}function go_bottom(){window.scrollTo(0,document.body.scrollHeight)}document.ready(function(){tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:1,orderedList:!1,scrollSmooth:!0})})</script><article class="post-wrap"><header class="post-header"><h1 class="post-title">一个来自保留IP地址的连接</h1><div class="post-meta">Author: <a itemprop="author" rel="author" href="/">zu1k</a> <span class="post-time">Date: <a href="#">2020-05-25&nbsp;&nbsp;15:22</a> </span><span class="post-category">Category: <a href="/categories/coding/">coding</a></span></div></header><div class="post-content"><p>昨天看了一篇文章，文章最后使用IP logger进行钓鱼，最后记录下来的IP地址让我大跌眼镜</p><p>万万没有想到，记录下来的IP地址竟然是是 244.242.105.51</p><img src="/2020/why-reveice-connection-from-class-e-ip/ip-logger.png" title="[IP Logger]"><p>这可是一个E类IP地址，是属于保留地址，是未来用来做ip研究用的，目前并没有开放使用啊</p><p>考虑到文章中是对一个地下黑客组织进行钓鱼，所以我有理由相信，这个访问记录是通过某种高超的我从来没有听说过的手段实现的</p><p>IP Logger为啥会记录到这样一个IP的访问呢？ 这个问题一直到现在都在困扰我</p><p>下面记录一下我对这个的分析</p><h2 id="大端？小端？"><a href="#大端？小端？" class="headerlink" title="大端？小端？"></a>大端？小端？</h2><p>众所周知计算机程序根据cpu架构和操作系统种类不同，数据在内存中存放有大端序和小端序两种情况，这个顺序叫做主机序</p><p>而网络传输需要在不同主机序的计算机之间兼容，所以又规定了一个网络序，规定网络传输一律使用大端序</p><p>文章中作者猜测是访问者使用的主机是小端序的，所以会又这样一个记录</p><p>我个人认为这个猜测不成立</p><p>因为一般ip层报文都是由操作系统网络栈来构造的，操作系统自身不会犯忘记转换成网络序的错误</p><p>即使是访问者技术高超自己写代码构造的ip包，那源ip是E类ip地址，返程的ip包根本没有路由啊，这样子连tcp连接都建立不了，更不要谈ip logger记录下浏览器的user-agent</p><h2 id="Tor"><a href="#Tor" class="headerlink" title="Tor?"></a>Tor?</h2><p>考虑到记录下来的user-agent与tor浏览器的一致，并且对方是黑客组织，使用tor也是非常普遍，所以分析一下通过tor能不能实现伪造自己的ip为E类ip</p><p>tor连接的流程中，每个tor relay不会知道完整的路由路径，只知道上一个节点与下一个节点，并且这个路由是在应用层实现的，如果黑客控制了某些tor relay，通过这些relay能不能实现这个伪造？</p><h3 id="提供onion-service"><a href="#提供onion-service" class="headerlink" title="提供onion service"></a>提供onion service</h3><p>如果ip logger提供onion service，那他记录下来的ip应该是 会合节点的ip</p><p>通过我上一篇博客学习的内容可以知道，这个会合节点是由客户端选择的，所以我们假设黑客这里选择了自己控制的某个tor relay作为会合节点，并且将这个E类ip地址写在介绍信中发送给介绍节点</p><p>ip logger服务器如果没有怀疑这个E类IP地址，通过tor网络去连接这个会合节点，那在它的exit relay那里一定会连不上这个ip，因为会出现空路由</p><p>所以如果要让连接成功建立，必须让ip logger到会合节点的relay路径中某个relay节点对这个错误的ip进行了更正，最简单的是控制exit relay，检查到最终访问的是错误ip便进行更正</p><p>而这个relay路径中的每个relay都是ip logger自己选择的，所以黑客需要控制tor网络中的大部分relay????这不现实！！！</p><h3 id="不提供onion-service"><a href="#不提供onion-service" class="headerlink" title="不提供onion service"></a>不提供onion service</h3><p>如果ip logger不是提供onion service，而是提供公开的服务，那它记录下来的应该是 黑客选择的exit relay，即使黑客控制了这个relay也没办法伪造ip啊</p><p>所以通过tor的某些机制伪造成这个E类ip不太现实</p><h2 id="路由劫持？"><a href="#路由劫持？" class="headerlink" title="路由劫持？"></a>路由劫持？</h2><p>我对公网的路由不太了解，但是看样子进行路由劫持是有可能的</p><p>如果黑客创建了一条假的路由路径，并在路由途中的某个节点对这个E类ip进行更正，也是有可能的，不过看起来难度很大啊</p><blockquote><p>才疏学浅，文中可能有错误，欢迎指正<br>目前这个问题还在困扰我，如果有大佬知道答案，希望能够告诉我</p></blockquote></div><section class="post-tags"><div><span>Tag(s):</span> <span class="tag"><a href="/tags/tor/"># tor</a> <a href="/tags/IP/"># IP</a></span></div><div><a href="javascript:window.history.back();">back</a> <span>· </span><a href="/">home</a></div></section><section class="post-nav"><a class="prev" rel="prev" href="/2020/dos-attack-on-360-university-user.html">利用360直播课评论区对用户浏览器dos攻击</a> <a class="next" rel="next" href="/2020/how-do-onion-service-work.html">Tor洋葱服务如何工作</a></section></article></div></div><footer id="footer" class="footer"><div class="copyright"><span>© zu1k | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span></div></footer></div></body></html>