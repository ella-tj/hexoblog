<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="referrer" content="unsafe-url"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="author" content="zu1k"><meta name="subtitle" content="an interest-driven blog"><meta name="description" content="Hi, I'm zu1k, a boy dreaming of traveling around the world. "><meta name="keywords" content="zu1k,lgf,zuik,lgf.im"><title>加快Github Pages国内访问速度 | zu1k</title><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/style.css"><script src="/js/script.js"></script><script src="/js/tocbot.min.js"></script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="zu1k" type="application/atom+xml"><link rel="alternate" href="/rss2.xml" title="zu1k" type="application/rss+xml"></head><body><div class="wrapper"><header><nav class="navbar"><div class="container"><div class="navbar-header header-logo"><a href="/">ZU1K</a></div><div class="menu navbar-right"><a class="menu-item" href="/archives">Posts</a> <a class="menu-item" href="/category">Category</a> <a class="menu-item" href="/tag">Tag</a> <a class="menu-item" href="/about">About</a> <a class="menu-item" href="/feed">Feed</a> <input id="switch_default" type="checkbox" class="switch_default"> <label for="switch_default" class="toggleBtn"></label></div></div></nav><nav class="navbar-mobile" id="nav-mobile"><div class="container"><div class="navbar-header"><div><a href="/">ZU1K</a><a id="mobile-toggle-theme">·&nbsp;Light</a></div><div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div></div><div class="menu" id="mobile-menu"><a class="menu-item" href="/archives">Posts</a> <a class="menu-item" href="/category">Category</a> <a class="menu-item" href="/tag">Tag</a> <a class="menu-item" href="/about">About</a> <a class="menu-item" href="/feed">Feed</a></div></div></nav></header><script>var mobileBtn=function(){var e=document.getElementsByClassName("menu-toggle")[0],t=document.getElementById("mobile-menu");e.classList.contains("active")?(e.classList.remove("active"),t.classList.remove("active")):(e.classList.add("active"),t.classList.add("active"))}</script><div class="main"><div class="container"><div class="post-toc"><div class="tocbot-list"></div><div class="tocbot-list-menu"><a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a> <a onclick="go_top()">Back to top</a> <a onclick="go_bottom()">Go to bottom</a></div></div><script>function expand_toc(){var o=document.querySelector(".tocbot-toc-expand");tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:6,orderedList:!1,scrollSmooth:!0}),o.setAttribute("onclick","collapse_toc()"),o.innerHTML="Collapse all"}function collapse_toc(){var o=document.querySelector(".tocbot-toc-expand");tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:1,orderedList:!1,scrollSmooth:!0}),o.setAttribute("onclick","expand_toc()"),o.innerHTML="Expand all"}function go_top(){window.scrollTo(0,0)}function go_bottom(){window.scrollTo(0,document.body.scrollHeight)}document.ready(function(){tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:1,orderedList:!1,scrollSmooth:!0})})</script><article class="post-wrap"><header class="post-header"><h1 class="post-title">加快Github Pages国内访问速度</h1><div class="post-meta"><span class="post-time"><a href="#">2020-03-19&nbsp;&nbsp;17:17</a> </span><span class="post-category">&nbsp;Category: <a href="/categories/coding/">coding</a> </span><span class="post-busuanzi"><span id="busuanzi_container_page_pv">&nbsp;Read: <span id="busuanzi_value_page_pv"></span></span></span></div></header><div class="post-content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>相信不少小伙伴都在使用 Github Pages 提供的免费静态网站托管来搭建自己的博客，但是因为墙的存在和特殊国情，使用 Github Pages 搭建的网站速度普遍不快，因此很多小伙伴只能转战国内付费的服务器和 CDN。</p><p>正巧我也在使用 Github Pages 搭建自己的静态博客，正好来说一下我的优化方法。</p><h2 id="压缩"><a href="#压缩" class="headerlink" title="压缩"></a>压缩</h2><p>默认情况下，如果我们查看 Hexo 生成的静态网页源代码，会发现存在大量的空格、空行、注释等无用内容。同样的，如果使用的 hexo 主题没有进行优化，大量的 css 和 js 文件也存在这样的垃圾内容。</p><p>如果你在一些大型网站右键查看网页源代码，你会发现他们的 html\js\css 是经过压缩处理的，没有多余的换行和注释，这势必会节省带宽流量和传输时间，提升用户体验。</p><p>所以我们优化速度的第一关就是对 Hexo 生成的代码进行压缩。</p><p>这里我使用的工具是 gulp</p><h3 id="安装-gulp"><a href="#安装-gulp" class="headerlink" title="安装 gulp"></a>安装 gulp</h3><p>在自己本机安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install gulp -g</span><br></pre></td></tr></table></figure><p>为了 Github Action 或其他 CI\CD 平台也能够进行安装，这里推荐</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install gulp --save-dev</span><br></pre></td></tr></table></figure><p>我们还需要一些依赖</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev \</span><br><span class="line">            gulp-minify-css \</span><br><span class="line">            gulp-babel \</span><br><span class="line">            gulp-uglify \</span><br><span class="line">            gulp-htmlmin \</span><br><span class="line">            gulp-htmlclean \</span><br><span class="line">            gulp-imagemin \</span><br><span class="line">            imagemin-jpegtran \</span><br><span class="line">            imagemin-svgo \</span><br><span class="line">            imagemin-gifsicle \</span><br><span class="line">            imagemin-optipng</span><br></pre></td></tr></table></figure><h3 id="创建配置文件"><a href="#创建配置文件" class="headerlink" title="创建配置文件"></a>创建配置文件</h3><p>在博客 hexo 的根目录下，新建 <code>gulpfile.js</code> 配置文件</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">&quot;gulp&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> minifycss = <span class="built_in">require</span>(<span class="string">&quot;gulp-minify-css&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> uglify = <span class="built_in">require</span>(<span class="string">&quot;gulp-uglify&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> htmlmin = <span class="built_in">require</span>(<span class="string">&quot;gulp-htmlmin&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> htmlclean = <span class="built_in">require</span>(<span class="string">&quot;gulp-htmlclean&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> imagemin = <span class="built_in">require</span>(<span class="string">&quot;gulp-imagemin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩css文件</span></span><br><span class="line">gulp.task(<span class="string">&quot;minify-css&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> gulp</span><br><span class="line">    .src(<span class="string">&quot;./public/**/*.css&quot;</span>)</span><br><span class="line">    .pipe(minifycss())</span><br><span class="line">    .pipe(gulp.dest(<span class="string">&quot;./public&quot;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩html</span></span><br><span class="line">gulp.task(<span class="string">&quot;minify-html&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> gulp</span><br><span class="line">    .src(<span class="string">&quot;./public/**/*.html&quot;</span>)</span><br><span class="line">    .pipe(htmlclean())</span><br><span class="line">    .pipe(</span><br><span class="line">      htmlmin(&#123;</span><br><span class="line">        collapseWhitespace: <span class="literal">true</span>,</span><br><span class="line">        collapseBooleanAttributes: <span class="literal">true</span>,</span><br><span class="line">        removeComments: <span class="literal">true</span>,</span><br><span class="line">        removeEmptyAttributes: <span class="literal">true</span>,</span><br><span class="line">        removeScriptTypeAttributes: <span class="literal">true</span>,</span><br><span class="line">        removeStyleLinkTypeAttributes: <span class="literal">true</span>,</span><br><span class="line">        minifyJS: <span class="literal">true</span>,</span><br><span class="line">        minifyCSS: <span class="literal">true</span>,</span><br><span class="line">        minifyURLs: <span class="literal">true</span>,</span><br><span class="line">        ignoreCustomFragments: [<span class="regexp">/\&#123;\&#123;[\s\S]*?\&#125;\&#125;/</span>],</span><br><span class="line">      &#125;)</span><br><span class="line">    )</span><br><span class="line">    .pipe(gulp.dest(<span class="string">&quot;./public&quot;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩js文件</span></span><br><span class="line">gulp.task(<span class="string">&quot;minify-js&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> gulp</span><br><span class="line">    .src([<span class="string">&quot;./public/**/*.js&quot;</span>, <span class="string">&quot;!./public/js/**/*min.js&quot;</span>])</span><br><span class="line">    .pipe(uglify())</span><br><span class="line">    .pipe(gulp.dest(<span class="string">&quot;./public&quot;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩图片</span></span><br><span class="line">gulp.task(<span class="string">&quot;minify-images&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> gulp</span><br><span class="line">    .src([</span><br><span class="line">      <span class="string">&quot;./public/**/*.png&quot;</span>,</span><br><span class="line">      <span class="string">&quot;./public/**/*.jpg&quot;</span>,</span><br><span class="line">      <span class="string">&quot;./public/**/*.gif&quot;</span>,</span><br><span class="line">      <span class="string">&quot;./public/**/*.svg&quot;</span>,</span><br><span class="line">    ])</span><br><span class="line">    .pipe(</span><br><span class="line">      imagemin([</span><br><span class="line">        imagemin.gifsicle(&#123; <span class="attr">interlaced</span>: <span class="literal">true</span> &#125;),</span><br><span class="line">        imagemin.mozjpeg(&#123; <span class="attr">quality</span>: <span class="number">75</span>, <span class="attr">progressive</span>: <span class="literal">true</span> &#125;),</span><br><span class="line">        imagemin.optipng(&#123; <span class="attr">optimizationLevel</span>: <span class="number">5</span> &#125;),</span><br><span class="line">        imagemin.svgo(&#123;</span><br><span class="line">          plugins: [&#123; <span class="attr">removeViewBox</span>: <span class="literal">true</span> &#125;, &#123; <span class="attr">cleanupIDs</span>: <span class="literal">false</span> &#125;],</span><br><span class="line">        &#125;),</span><br><span class="line">      ])</span><br><span class="line">    )</span><br><span class="line">    .pipe(gulp.dest(<span class="string">&quot;./public&quot;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">gulp.task(</span><br><span class="line">  <span class="string">&quot;default&quot;</span>,</span><br><span class="line">  gulp.series(</span><br><span class="line">    gulp.parallel(<span class="string">&quot;minify-html&quot;</span>, <span class="string">&quot;minify-css&quot;</span>, <span class="string">&quot;minify-js&quot;</span>, <span class="string">&quot;minify-images&quot;</span>)</span><br><span class="line">  )</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><p>在使用 <code>hexo g</code> 生成静态网站后， 运行 <code>gulp</code> 进行压缩</p><h2 id="使用-CDN"><a href="#使用-CDN" class="headerlink" title="使用 CDN"></a>使用 CDN</h2><p>如果你查看博客的网络请求内容，你会发现在 html 加载之后，还有一堆小文件等待加载，而这些 css\js\图片文件的加载占据了大部分的网页打开时间。</p><p>因为 Github Pages 的延迟巨大，速度极慢，我们更有必要使用国内的 CDN 对这些资源进行分发。</p><p>不想使用国内付费的 CDN 服务，我尝试过使用 CloudFlare 进行加速（实质减速）效果不佳，后来发现了 jsDelivr。</p><p>jsDelivr 是一家开源免费 CDN，主要是对 npm 包进行 CDN 分发</p><p>绝妙的是它还能对 Github 和 Wordpress 进行 CDN 分发</p><p>我们可以借助 jsDelivr 的 Github 资源分发 服务来对我们博客中的 css\js\小图片进行加速</p><blockquote><p>这是我目前找到的唯一一家在国内有节点并且不需要备案的 CDN 分发服务</p></blockquote><p>这里我就以我使用的主题为例，分享一下我如何使用 jsDelivr 进行 CDN 分发</p><h3 id="链接格式"><a href="#链接格式" class="headerlink" title="链接格式"></a>链接格式</h3><p>jsDelivr 针对 Github 资源有众多 URL 格式</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;user&#x2F;repo@version&#x2F;file</span><br><span class="line">https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;jquery&#x2F;jquery@3.2.1&#x2F;dist&#x2F;jquery.min.js</span><br><span class="line">https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;jquery&#x2F;jquery@3.2&#x2F;dist&#x2F;jquery.min.js</span><br><span class="line">https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;jquery&#x2F;jquery@3&#x2F;dist&#x2F;jquery.min.js</span><br><span class="line">https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;jquery&#x2F;jquery&#x2F;dist&#x2F;jquery.min.js</span><br><span class="line">https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;jquery&#x2F;jquery@3.2.1&#x2F;src&#x2F;core.min.js</span><br><span class="line">https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;jquery&#x2F;jquery&#x2F;</span><br></pre></td></tr></table></figure><p>考虑到 jsDelivr 默认缓存时间是 7 天，如果我们想要修改实时生效而不需要等到缓存过期，最适合的是</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;jquery&#x2F;jquery@3.2.1&#x2F;dist&#x2F;jquery.min.js</span><br><span class="line"></span><br><span class="line">https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F; github用户名 &#x2F; 库名 @ 版本号或者tag &#x2F; 路径&#x2F;文件名</span><br></pre></td></tr></table></figure><p>我们可以通过打 tag 来访问同一个资源文件的不同版本，而不需要考虑缓存时间</p><h3 id="替换链接"><a href="#替换链接" class="headerlink" title="替换链接"></a>替换链接</h3><p>大部分 hexo 主题并不会对使用到的 js\css\图片\字体 套上 CDN，我们来手动替换</p><h4 id="css-样式表"><a href="#css-样式表" class="headerlink" title="css 样式表"></a>css 样式表</h4><p>大部分 css 样式会在 <code>head</code> 标签里面引入，这里的 css 样式表会阻塞页面的渲染，导致打开慢的体验，所以需要特别注意</p><p>我将我使用的主题的 style.css \ rtl.css \ disquesjs.css 替换成 jsDelivr，明显提升了等待时间</p><img src="/2020/speedup-github-page/head.jpg" title="[head css]"><p>还有一些其他地方的 css 引入</p><img src="/2020/speedup-github-page/css2.jpg" title="[css in style]"><h4 id="js-脚本"><a href="#js-脚本" class="headerlink" title="js 脚本"></a>js 脚本</h4><p>寻找并替换各种调用到的 js 脚本</p><img src="/2020/speedup-github-page/js1.jpg" title="[css in style]"><p>main.js</p><img src="/2020/speedup-github-page/js2.jpg" title="[css in style]"><p>disqusjs.js</p><img src="/2020/speedup-github-page/js3.jpg" title="[css in style]"><p>还有其他的一些地方，不一一列举了</p><h4 id="字体"><a href="#字体" class="headerlink" title="字体"></a>字体</h4><p>字体需要特别注意，通常情况下比较大，耗时比较长</p><img src="/2020/speedup-github-page/font1.jpg" title="[font replace]"><p>我使用的主题使用的字体通过 <code>all.min.css</code> 引入，因为前面这个 css 样式已经通过 jsDelivr 导入，里面的字体使用的是相对链接，所以字体默认也是通过 jsDelivr 引入了</p><h4 id="img-小图片"><a href="#img-小图片" class="headerlink" title="img 小图片"></a>img 小图片</h4><p>一般是 logo 等资源，根据主题自行替换</p><blockquote><p>更新：为了更好的控制版本和决定是否使用 jsDelivr, 可以将这个地方独立出来放到配置文件里</p></blockquote><p>_config.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cdn:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">url:</span> <span class="string">https://cdn.jsdelivr.net/gh/zu1k/blog@0.0.1.2</span></span><br></pre></td></tr></table></figure><p>用到的地方</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- styles --&gt;</span><br><span class="line">&lt;% if (theme.cdn.enabled) &#123; %&gt;</span><br><span class="line">  &lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;&lt;%&#x3D; theme.cdn.url %&gt;&#x2F;css&#x2F;style.css&quot;&gt;</span><br><span class="line">&lt;% &#125; else &#123; %&gt;</span><br><span class="line">  &lt;%- css(&#39;css&#x2F;style&#39;) %&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br><span class="line"></span><br><span class="line">其他的地方同样的方法</span><br></pre></td></tr></table></figure><h2 id="加载时文字可见"><a href="#加载时文字可见" class="headerlink" title="加载时文字可见"></a>加载时文字可见</h2><p>无论怎样优化，字体加载的时间无法忽略，这段时间的网页文字显示为空，这给用户带来卡顿感</p><p>我们必须使字体加载时文字可见，这样才能弥补 github pages 的慢</p><p>具体方法是将各 <code>@font-face</code> 中 <code>font-display</code> 设置为 <code>swap</code>, 这样可以在字体未加载完时临时使用系统字体替代，加载完后重新渲染字体</p><img src="/2020/speedup-github-page/font-swap.jpg" title="[font display]"><p>每一个地方都需要改，自己搜索吧</p><h2 id="使用-DisqusJS"><a href="#使用-DisqusJS" class="headerlink" title="使用 DisqusJS"></a>使用 DisqusJS</h2><p>由于众所周知的原因，disqus 被墙了，国内访问不了，而大部分 hexo 网站都使用 disqus 作为评论系统，这导致网页会卡在评论区的加载上，虽然网页已经加载完了，但进度条还在进行，给用户带来慢的感觉。</p><p>并且，即使有的用户翻墙能够访问 Disqus，但 Disqus 本身非常笨重，各种 CSS/JS/Font/API 加起来请求不小于 2MB，当 Disqus 加载时，浏览器会在主线程中同步解析、渲染 Disqus，造成卡顿感。</p><p>在上网搜索之后，找到了一个替代方案，那就是苏卡卡大佬的 DisqusJS，大家可以根据教程对自己博客的主题进行修改</p><p>参考链接：</p><ul><li><a target="_blank" rel="noopener" href="https://blog.skk.moe/post/disqusjs/">https://blog.skk.moe/post/disqusjs/</a></li><li><a target="_blank" rel="noopener" href="https://disqusjs.skk.moe/">https://disqusjs.skk.moe/</a></li><li><a target="_blank" rel="noopener" href="https://github.com/SukkaW/DisqusJS">https://github.com/SukkaW/DisqusJS</a></li></ul><p>对于使用的 Disqus API 反代，我自己测试发现苏卡卡大佬提供的速度不太行，不知道是什么原因，所以推荐自己进行搭建，我是用的是 zeit 进行搭建，感觉还不错</p><blockquote><p>如果 disqusJS 默认样式不适合自己的主题，推荐 fork 原库进行修改，注意要使用 1.2.6，最新的 master 在懒加载上有点问题</p></blockquote><h2 id="使用懒加载"><a href="#使用懒加载" class="headerlink" title="使用懒加载"></a>使用懒加载</h2><p>如果图片和评论区随着页面在一开始就加载，势必会拖累网页首次渲染和文字的迅速显示，这里最好的办法是使用懒加载技术</p><h3 id="图片懒加载"><a href="#图片懒加载" class="headerlink" title="图片懒加载"></a>图片懒加载</h3><p>对于图片，我使用了 <code>hexo-lazyload-image</code> 这个插件</p><p>安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-lazyload-image --save</span><br></pre></td></tr></table></figure><p>配置文件中添加</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lazyload:</span><br><span class="line">  <span class="built_in">enable</span>: <span class="literal">true</span></span><br><span class="line">  onlypost: <span class="literal">false</span></span><br><span class="line">  loadingImg: https://cdn.jsdelivr.net/gh/zu1k/blog@0.0.1.2/images/loading.png</span><br></pre></td></tr></table></figure><blockquote><p>顺便给懒加载添加了 cdn 功能，可以替换成 cdn 链接来加速</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-lazyload-image-cdn --save</span><br></pre></td></tr></table></figure><p>配置文件中添加</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">lazyload:</span><br><span class="line">  <span class="built_in">enable</span>: <span class="literal">true</span></span><br><span class="line">  onlypost: <span class="literal">false</span></span><br><span class="line">  loadingImg: <span class="comment"># eg ./images/loading.gif</span></span><br><span class="line">  cdn:</span><br><span class="line">    enabled: <span class="literal">false</span></span><br><span class="line">    url: https://cdn.com</span><br></pre></td></tr></table></figure><h3 id="评论懒加载"><a href="#评论懒加载" class="headerlink" title="评论懒加载"></a>评论懒加载</h3><p>对于评论区，很多情况下用户根本不会划到页面底部（文章写得太烂没人看得下去）。</p><p>所以我这里对 disqus 的加载使用懒加载技术，参考 <a target="_blank" rel="noopener" href="https://blog.skk.moe/post/prevent-disqus-from-slowing-your-site/">https://blog.skk.moe/post/prevent-disqus-from-slowing-your-site/</a></p><p>我使用的是 disqusJS, 下面给出加载的 js 代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- DisqusJS Comments --&gt;</span><br><span class="line">&lt;% <span class="keyword">if</span> (theme.disqusjs.enabled &amp;&amp; theme.disqusjs.shortname)&#123; %&gt;</span><br><span class="line">  &lt;script crossorigin defer src=<span class="string">&quot;https://cdn.jsdelivr.net/gh/zu1k/DisqusJS@1.2.6.3/dist/disqus.js&quot;</span> id=<span class="string">&quot;disqusjs-script&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">  &lt;script&gt;</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">&quot;disqusjs-script&quot;</span>).addEventListener(<span class="string">&quot;load&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="function"><span class="keyword">function</span> <span class="title">t</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> dsqjs = <span class="keyword">new</span> DisqusJS(&#123;</span><br><span class="line">                  shortname: <span class="string">&#x27;&lt;%= theme.disqusjs.shortname %&gt;&#x27;</span>,</span><br><span class="line">                  siteName: <span class="string">&#x27;&lt;%= theme.disqusjs.siteName %&gt;&#x27;</span>,</span><br><span class="line">                  api: <span class="string">&#x27;&lt;%= theme.disqusjs.api %&gt;&#x27;</span>,</span><br><span class="line">                  apikey: <span class="string">&#x27;&lt;%= theme.disqusjs.apikey %&gt;&#x27;</span>,</span><br><span class="line">                  admin: <span class="string">&#x27;&lt;%= theme.disqusjs.admin %&gt;&#x27;</span>,</span><br><span class="line">                  adminLabel: <span class="string">&#x27;&lt;%= theme.disqusjs.adminLabel %&gt;&#x27;</span></span><br><span class="line">              &#125;);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">var</span> runningOnBrowser = <span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">&quot;undefined&quot;</span>;</span><br><span class="line">          <span class="keyword">var</span> isBot = runningOnBrowser &amp;&amp; !(<span class="string">&quot;onscroll&quot;</span> <span class="keyword">in</span> <span class="built_in">window</span>) || <span class="keyword">typeof</span> navigator !== <span class="string">&quot;undefined&quot;</span> &amp;&amp; <span class="regexp">/(gle|ing|ro|msn)bot|crawl|spider|yand|duckgo/i</span>.test(navigator.userAgent);</span><br><span class="line">          <span class="keyword">var</span> supportsIntersectionObserver = runningOnBrowser &amp;&amp; <span class="string">&quot;IntersectionObserver&quot;</span> <span class="keyword">in</span> <span class="built_in">window</span>;</span><br><span class="line">          <span class="keyword">if</span> (!isBot &amp;&amp; supportsIntersectionObserver) &#123;</span><br><span class="line">              <span class="keyword">var</span> disqus_observer = <span class="keyword">new</span> IntersectionObserver(<span class="function"><span class="keyword">function</span>(<span class="params">entries</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (entries[<span class="number">0</span>].isIntersecting) &#123;</span><br><span class="line">                  t();</span><br><span class="line">                  disqus_observer.disconnect();</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;, &#123; <span class="attr">threshold</span>: [<span class="number">0</span>] &#125;);</span><br><span class="line">              disqus_observer.observe(<span class="built_in">document</span>.getElementById(<span class="string">&#x27;disqus_thread&#x27;</span>));</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            t();</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;, <span class="number">1</span>);</span><br><span class="line">    &#125;,!<span class="number">0</span></span><br><span class="line">  );</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure><h2 id="终极大招"><a href="#终极大招" class="headerlink" title="终极大招"></a>终极大招</h2><p>如果经过上面的优化，你还对博客的加载速度不满意，那一定是 github pages 服务器在美国的原因，200+ms 的延迟导致首字节返回时间不短</p><p>其实支持通过 Github 仓库代码进行构建，部署为静态网站的平台不值 github pages 一家，我使用过的比较好的是 <code>zeit.co</code> ， 国内访问走的是台湾的 gcp 节点，延迟低速度快，推荐</p><p>具体使用方法非常简单，自行摸索吧</p><blockquote><p>更新: 刚知道，如果更新太快的话，zeit 会暂停构建部署的</p><p>You are pushing commits at a very fast pace (across the whole organization).<br>Due to that, we cannot deploy the commit e80751b.</p><p>You can try again later or upgrade your plan.</p></blockquote><h2 id="辅助优化"><a href="#辅助优化" class="headerlink" title="辅助优化"></a>辅助优化</h2><p>使用谷歌提供的 <a target="_blank" rel="noopener" href="https://developers.google.com/speed/pagespeed/insights/">Pagespeed Insights</a> 工具分析网页加载并根据建议进行优化</p></div><section class="post-tags"><div><span>Tags:</span> <span class="tag"><a href="/tags/coding/">#coding</a> <a href="/tags/github/">#github</a> <a href="/tags/jsdelivr/">#jsdelivr</a></span></div><div><a href="javascript:window.history.back();">back</a> <span>· </span><a href="/">home</a></div></section><section class="post-nav"><a class="prev" rel="prev" href="/2020/use-github-actions-to-auto-deploy-hexo.html">使用Github Actions对Hexo博客自动部署</a> <a class="next" rel="next" href="/2020/ubuntu-iptables-nat.html">使用iptables将ubuntu配置为路由器</a></section></article></div></div><footer id="footer" class="footer"><div class="copyright" style="color:#bfc4c7"><span>© zu1k | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span></div><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></footer></div></body></html>