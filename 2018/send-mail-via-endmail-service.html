<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="author" content="zu1k"><meta name="subtitle" content="an interest-driven blog"><meta name="description" content="Hi, I'm zu1k, a boy dreaming of traveling around the world. "><meta name="keywords" content="zu1k,lgf,zuik,lgf.im"><title>通过Sendmail服务发送邮件 | zu1k</title><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/style.css"><script src="/js/script.js"></script><script src="/js/tocbot.min.js"></script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="zu1k" type="application/atom+xml"><link rel="alternate" href="/rss2.xml" title="zu1k" type="application/rss+xml"></head><body><div class="wrapper"><header><nav class="navbar"><div class="container"><div class="navbar-header header-logo"><a href="/">ZU1K</a></div><div class="menu navbar-right"><a class="menu-item" href="/archives">Posts</a> <a class="menu-item" href="/category">Category</a> <a class="menu-item" href="/tag">Tag</a> <a class="menu-item" href="/about">About</a> <a class="menu-item" href="/feed">Feed</a> <input id="switch_default" type="checkbox" class="switch_default"> <label for="switch_default" class="toggleBtn"></label></div></div></nav><nav class="navbar-mobile" id="nav-mobile"><div class="container"><div class="navbar-header"><div><a href="/">ZU1K</a><a id="mobile-toggle-theme">·&nbsp;Light</a></div><div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div></div><div class="menu" id="mobile-menu"><a class="menu-item" href="/archives">Posts</a> <a class="menu-item" href="/category">Category</a> <a class="menu-item" href="/tag">Tag</a> <a class="menu-item" href="/about">About</a> <a class="menu-item" href="/feed">Feed</a></div></div></nav></header><script>var mobileBtn=function(){var e=document.getElementsByClassName("menu-toggle")[0],t=document.getElementById("mobile-menu");e.classList.contains("active")?(e.classList.remove("active"),t.classList.remove("active")):(e.classList.add("active"),t.classList.add("active"))}</script><div class="main"><div class="container"><div class="post-toc"><div class="tocbot-list"></div><div class="tocbot-list-menu"><a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a> <a onclick="go_top()">Back to top</a> <a onclick="go_bottom()">Go to bottom</a></div></div><script>function expand_toc(){var o=document.querySelector(".tocbot-toc-expand");tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:6,orderedList:!1,scrollSmooth:!0}),o.setAttribute("onclick","collapse_toc()"),o.innerHTML="Collapse all"}function collapse_toc(){var o=document.querySelector(".tocbot-toc-expand");tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:1,orderedList:!1,scrollSmooth:!0}),o.setAttribute("onclick","expand_toc()"),o.innerHTML="Expand all"}function go_top(){window.scrollTo(0,0)}function go_bottom(){window.scrollTo(0,document.body.scrollHeight)}document.ready(function(){tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:1,orderedList:!1,scrollSmooth:!0})})</script><article class="post-wrap"><header class="post-header"><h1 class="post-title">通过Sendmail服务发送邮件</h1><div class="post-meta">Author: <a itemprop="author" rel="author" href="/">zu1k</a> <span class="post-time">Date: <a href="#">2018-12-03&nbsp;&nbsp;17:59</a> </span><span class="post-category">Category: <a href="/categories/coding/">coding</a></span></div></header><div class="post-content"><p>通过Sendmail服务发送邮件</p><p>系统centos7</p><p>需要开启25端口</p><a id="more"></a><h3 id="安装sendmail"><a href="#安装sendmail" class="headerlink" title="安装sendmail"></a>安装sendmail</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum  -y  install sendmail  sendmail-cf</span><br></pre></td></tr></table></figure><h3 id="安装MTA功能测试用软件"><a href="#安装MTA功能测试用软件" class="headerlink" title="安装MTA功能测试用软件"></a>安装MTA功能测试用软件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install  mailx   php</span><br></pre></td></tr></table></figure><h3 id="切换系统的邮件发送接口"><a href="#切换系统的邮件发送接口" class="headerlink" title="切换系统的邮件发送接口"></a>切换系统的邮件发送接口</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alternatives --config mta</span><br></pre></td></tr></table></figure><p>画面显示：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">There are 2 programs which provide &#x27;mta&#x27;.</span><br><span class="line"></span><br><span class="line">Selection    Command</span><br><span class="line">-----------------------------------------------</span><br><span class="line">+ 1           /usr/sbin/sendmail.postfix</span><br><span class="line">*  2           /usr/sbin/sendmail.sendmail</span><br><span class="line"></span><br><span class="line">Enter to keep the current selection[+], or type selection number: 2</span><br></pre></td></tr></table></figure><p>输入2后回车即把MTA功能切换到sendmail上，+号会显示在sendmail的行头。</p><h3 id="配置sendmail"><a href="#配置sendmail" class="headerlink" title="配置sendmail"></a>配置sendmail</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/mail/sendmail.mc</span><br><span class="line"></span><br><span class="line">DAEMON_OPTIONS(\`Port=smtp,Addr=127.0.0.1, Name=MTA\&#x27;)dnl</span><br><span class="line"></span><br><span class="line">把Addr的值从127.0.0.1修改为0.0.0.0，不限制使用MTA的IP。</span><br><span class="line"></span><br><span class="line">m4 /etc/mail/sendmail.mc &gt; /etc/mail/sendmail.cf</span><br><span class="line">生成正式的配置文件。</span><br></pre></td></tr></table></figure><h3 id="重启并测试功能"><a href="#重启并测试功能" class="headerlink" title="重启并测试功能"></a>重启并测试功能</h3><p><code>reboot -f</code></p><p>重启完成后确认MTA程序已经切换到sendmail</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep sendmail</span><br><span class="line"></span><br><span class="line">      root       1003  0.0  0.2  88688  2280 ?        Ss   10:40   0:00 sendmail: accepting connections</span><br><span class="line">      smmsp      1018  0.0  0.1  84120  1912 ?        Ss   10:40   0:00 sendmail: Queue runner@01:00:00 for /var/spool/clientmqueue</span><br><span class="line">      root       1141  0.0  0.0 112660   968 pts/1    R+   10:51   0:00 grep --color=auto sendmail</span><br><span class="line"></span><br><span class="line">      sendmail的相关进程已经启动</span><br><span class="line"></span><br><span class="line">ps aux | grep postfix</span><br><span class="line"></span><br><span class="line">      root       1161  0.0  0.0 112660   968 pts/1    R+   11:04   0:00 grep --color=auto postfix</span><br><span class="line"></span><br><span class="line">      postfix的相关进程都没有开启</span><br></pre></td></tr></table></figure><h3 id="用PHP函数发送邮件"><a href="#用PHP函数发送邮件" class="headerlink" title="用PHP函数发送邮件"></a>用PHP函数发送邮件</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">php -a</span><br><span class="line"></span><br><span class="line">在PHP的交互界面下输入以下函数</span><br><span class="line"></span><br><span class="line">mail(<span class="string">&#x27;test@sohu.com&#x27;</span>, <span class="string">&quot;Test email content&quot;</span>, <span class="string">&quot;sendmail title&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;-f testname@sendmail.com&quot;</span>);</span><br></pre></td></tr></table></figure><ul><li>使用PHP接口做测试的好处是可以随意指定发送方的邮件地址，即mail函数的最后一个参数。</li></ul><p>即使系统的hostname未设置也可以正常发送出邮件。</p><h3 id="使用linux的mail命令发送邮件"><a href="#使用linux的mail命令发送邮件" class="headerlink" title="使用linux的mail命令发送邮件"></a>使用linux的mail命令发送邮件</h3><p>mail命令就没有使用自定义的邮件发送地址，而是使用HOSTNAME。</p><p>安装系统时由于没有对hostname做特别设置，HOSTNAME的值是默认的 localhost.localdomain</p><p>这样的邮件域名会被大多数邮箱如163，QQ拒收。</p><p>查看邮件发送log会发现以下错误</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat /var/log/maillog</span><br><span class="line"></span><br><span class="line">      dsn=4.1.8, stat=Deferred: 450 4.1.8 &lt;root@localhost.localdomain&gt;: Sender address rejected: Domain not found</span><br></pre></td></tr></table></figure><p>修改HOSTNAME</p><p><code>vi /etc/hosts</code></p><p>在最后加上一行</p><p><code>192.168.2.108 intest.com</code></p><p>这里的IP地址是我跑sendmail虚拟机的IP，需根据实际情况设置</p><ul><li>其实这个文件hosts只是用来设置本地路由表，但填上本机IP时，系统在启动初始化中查到本机IP在hosts中，就会用hosts文件中对应的域名来设置HOSTNAME。</li></ul><p>重新启动</p><p><code>reboot -f</code></p><p>重启后发现本地的DNS配置文件etc/resolv.conf 已经被自动更新。</p><p>内容变成 <code>nameserver 192.168.2.1</code></p><p>执行mail命令发送邮件</p><p><code>echo &quot;test mail content&quot;|mail -s &quot;Mail title&quot; test@sohu.com</code></p><hr><h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><h3 id="切换系统的邮件发送接口-1"><a href="#切换系统的邮件发送接口-1" class="headerlink" title="切换系统的邮件发送接口"></a>切换系统的邮件发送接口</h3><p><code>alternatives --config mta</code></p><ul><li>Postfix是Centos7系统默认自带。 也可以用命令 yum list installed | grep postfix 确认</li></ul><p>选择postfix所在行的编号后回车</p><h3 id="重启并测试功能-1"><a href="#重启并测试功能-1" class="headerlink" title="重启并测试功能"></a>重启并测试功能</h3><p><code>reboot -f</code></p><p>重启后查看进程看到postfix相关的进程已经启动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep postfix</span><br><span class="line"></span><br><span class="line">      root       1093  0.0  0.2  89544  2172 ?        Ss   08:55   0:00 /usr/libexec/postfix/master -w</span><br><span class="line">      postfix    1094  0.0  0.4  89648  4016 ?        S    08:55   0:00 pickup -l -t unix -u</span><br><span class="line">      postfix    1095  0.0  0.4  89716  4044 ?        S    08:55   0:00 qmgr -l -t unix -u</span><br><span class="line">      postfix    1237  0.0  0.4  89796  4072 ?        S    09:08   0:00 cleanup -z -t unix -u</span><br><span class="line">      postfix    1238  0.0  0.4  89652  4024 ?        S    09:08   0:00 trivial-rewrite -n rewrite -t unix -u</span><br><span class="line">      postfix    1239  0.0  0.4  89856  4272 ?        S    09:08   0:00 smtp -t unix -u</span><br><span class="line">      root       1274  0.0  0.0 112660   972 pts/1    R+   09:09   0:00 grep --color=auto postfix</span><br></pre></td></tr></table></figure><p>系统的hostname已经在sendmail配置的第六步中完成了配置，这里就直接使用PHP与mail命令</p><p>两种方法做测试。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">php -a</span><br><span class="line"></span><br><span class="line">mail(&#x27;test@sohu.com&#x27;, &quot;Test email No1&quot;, &quot;postfix mail&quot;, null, &quot;-f test@ccfst.com&quot;);</span><br><span class="line">* php的mail函数可以随意指定发送地址</span><br><span class="line"></span><br><span class="line">echo &quot;test mail&quot;|mail -s &quot;postfix mail title&quot; test@sohu.com</span><br></pre></td></tr></table></figure></div><section class="post-tags"><div><span>Tag(s):</span> <span class="tag"><a href="/tags/mail/"># mail</a> <a href="/tags/php/"># php</a></span></div><div><a href="javascript:window.history.back();">back</a> <span>· </span><a href="/">home</a></div></section><section class="post-nav"><a class="prev" rel="prev" href="/2018/if-time-could-stop-at-the-moment-when-we-first-met.html">人生若只如初见</a> <a class="next" rel="next" href="/2018/crawl-all-the-courses-of-the-educational-administration-system-and-store-them-in-the-database.html">爬取教务系统所有课程并存入数据库</a></section></article></div></div><footer id="footer" class="footer"><div class="copyright"><span>© zu1k | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span></div></footer></div></body></html>